{% extends "layouts/base.html" %}

{% block title %} Populate {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

  <div class="container-fluid py-4">
    <div class="row min-vh-80 h-100">
      <div class="col-12">
        {% comment %} Populate Scripts {% endcomment %}
      
      <div class="col-lg-6">
        <div class="card h-100">
          <div class="card-header pb-0 p-3">
            <div class="row">
              <div class="col-6 d-flex align-items-center">
                <h6 class="mb-0">Populate Scripts</h6>
              </div>
            </div>
          </div>
          <div class="card-body p-3 pb-0">
            <ul class="list-group">
              <li class="list-group-item border-1 d-flex justify-content-between ps-2 mb-2 border-radius-lg">
                <div class="d-flex flex-column">
                  <h6 class="mb-1 text-white font-weight-bold text-sm">Stocks List</h6>
                  <span class="text-xs">Update all stocks symbols from NSE</span>
                </div>
                <div class="d-flex align-items-center text-sm">
                  <button class="btn btn-link text-white text-sm mb-0 px-0 ms-4" onclick=stocksListPopulate()>
                    <i class="material-icons text-lg position-relative me-1">send</i> request
                  </button>
                </div>
              </li>
              <li class="list-group-item border-1 d-flex justify-content-between ps-2 mb-2 border-radius-lg">
                <div class="d-flex flex-column">
                  <h6 class="mb-1 text-white font-weight-bold text-sm">Stocks List</h6>
                  <span class="text-xs">Update all stocks symbols from NSE</span>
                  <input class="numInputWrapper" type="text" id="symbol_name" placeholder="Symbol" />
                  <input class="numInputWrapper" type="date" id="from_date"/>
                  <input class="numInputWrapper" type="date" id="to_date"/>
                </div>
                <div class="d-flex align-items-center text-sm">
                  <button class="btn btn-link text-white text-sm mb-0 px-0 ms-4" onclick=stocksCandlePopulate()>
                    <i class="material-icons text-lg position-relative me-1">send</i> request
                  </button>
                </div>
              </li>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

    {% include 'includes/footer.html' %}

  </div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
  
  async function stocksListPopulate() {
    const response = await fetch('/api/data/populate/nse/', { method: 'GET' });
    console.log('status code: ', response.status);
  };

  async function stocksCandlePopulate() {
    symbol= document.getElementById("symbol_name").value
    from_date= new Date(document.getElementById("from_date").value)
    from_date = `${from_date.getDate()}-${from_date.getMonth()+1}-${from_date.getFullYear()}`
    to_date = new Date(document.getElementById("to_date").value)
    to_date = `${to_date.getDate()}-${to_date.getMonth()+1}-${to_date.getFullYear()}`
    const url = `/api/data/populate/nse/?symbol=${symbol}&from_date=${from_date}&to_date=${to_date}`
    const response = await fetch(url, { 
      method: 'POST', 
      headers: { 
        'Content-Type': 'application/json',
        "X-CSRFToken": "{{csrf_token}}" 
      },
    });
    console.log('status code: ', response.status);
    //console.log('from: ', from_date)
    //console.log('to: ', to_date)
  };

</script>
{% endblock javascripts %}
